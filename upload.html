<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Thêm sản phẩm</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white shadow-lg p-8 rounded-xl w-full max-w-md relative">
   <!-- tkozlee -->
<a href="https://www.tiktok.com/@maclame98" target="_blank"
  class="absolute top-4 left-4 flex items-center gap-2 px-4 py-1.5 rounded-full bg-gray-800 text-white shadow hover:opacity-90 active:scale-95 transition-all duration-150">
 
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" class="w-4 h-4 fill-white">
    <path d="M168,48a48.05,48.05,0,0,0,48,48v24a71.84,71.84,0,0,1-32-7.39V152a72,72,0,1,1-72-72,71.36,71.36,0,0,1,8,.46V104.3a48,48,0,1,0,24,41.7V24h24Z"/>
  </svg>
  <span class="text-sm font-medium">Follow</span>
</a>

<!-- tkozlee -->
<button onclick="copyLink()"
  class="absolute top-4 right-4 flex items-center gap-2 px-4 py-1.5 rounded-full bg-gray-800 text-white shadow hover:opacity-90 active:scale-95 transition-all duration-150">
 
  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
      d="M4 12v.01M4 12a8 8 0 118 8m-8-8a8 8 0 018-8m0 8h4m0 0l-2-2m2 2l-2 2" />
  </svg>
  <span class="text-sm font-medium">Share</span>
</button>

 <!-- tkozlee -->
<div class="flex flex-col items-center space-y-3 mt-4 mb-4">


  
  <img src="./images/91NzJyUS9Xb3JrLnBuZw.jpg" alt="maclame avatar"
       class="w-32 h-32 rounded-full border-2 border-white shadow-md object-cover">
  <h1 class="text-3xl font-bold text-gray-800">@maclame98</h1>
</div>

    <h1 class="text-xl font-bold mb-4">🛒 Thêm sản phẩm</h1>

    <form id="productForm" class="space-y-4">
      <input type="text" id="name" placeholder="Tên sản phẩm" required class="w-full px-4 py-2 border rounded" />
      <input type="url" id="link" placeholder="Link sản phẩm (affiliate)" required class="w-full px-4 py-2 border rounded" />
      <input type="file" id="imageFile" accept=".jpg,.jpeg,.png" required class="w-full px-4 py-2 border rounded" />
     <select id="category" required class="w-full px-4 py-2 border rounded bg-white text-gray-700">
  <option value="" disabled selected>Chọn danh mục</option>
  <option value="Chân Váy">Áo</option>
         <option value="Chân Váy">Chân Váy</option>
  <option value="Set">Set</option>
  <option value="Đầm">Đầm</option>
  <option value="Quần">Quần</option>
  <option value="Phụ Kiện">Phụ Kiện</option>
</select>

      <button type="submit" class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800 w-full">
        Thêm Sản Phẩm
      </button>
    </form>

    <div id="toast"
      class="fixed top-5 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-5 py-3 rounded-xl shadow-lg text-sm opacity-0 pointer-events-none transition-opacity duration-300 z-50">
      Đã thêm thành công!
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA8IensKclYAvGB1QyzaavqURIgH5IKH_I",
      authDomain: "maclame-c7e9c.firebaseapp.com",
      projectId: "maclame-c7e9c",
      storageBucket: "maclame-c7e9c.appspot.com",
      messagingSenderId: "857173133731",
      appId: "1:857173133731:web:d4fd93772e34a86181b216",
      measurementId: "G-TZCS4QL10T"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const form = document.getElementById("productForm");
    const toast = document.getElementById("toast");

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.remove("opacity-0");
      toast.classList.add("opacity-100");
      setTimeout(() => toast.classList.add("opacity-0"), 2000);
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value.trim();
      const link = document.getElementById("link").value.trim();
      const file = document.getElementById("imageFile").files[0];
      const category = document.getElementById("category").value.trim();

      if (!file || !/\.(jpg|jpeg|png)$/i.test(file.name)) {
        showToast("Chỉ chấp nhận ảnh .jpg hoặc .png");
        return;
      }

      try {
        // Upload ảnh lên Firebase Storage
        const imageRef = ref(storage, `product-images/${Date.now()}_${file.name}`);
        await uploadBytes(imageRef, file);
        const imageUrl = await getDownloadURL(imageRef);

        // Thêm sản phẩm vào Firestore
        await addDoc(collection(db, "products"), {
          name,
          link,
          image: imageUrl,
          category
        });

        showToast("Đã thêm thành công!");
        form.reset();

        // Reload nếu dùng trong iframe hoặc trang chính
        setTimeout(() => window.parent.location.reload(), 1000);
      } catch (err) {
        showToast("Lỗi: " + err.message);
      }
    });
  </script>
</body>
</html>
